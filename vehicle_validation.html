<!-- Enable multiple file uploads for all file inputs -->
<script>
  $("input[type=file]").attr("multiple", "multiple");
</script>

<script>
  $(document).ready(function () {
    "use strict";

    // Hide all error messages initially and remove any error classes
    $('[wr-type="error"]').hide();
    $('[wr-type="required-field"]').removeClass("error");

    let formErrors = false;

    /**
     * Utility function to display the error state for a given field.
     * @param {object} $field - jQuery-wrapped field element
     */
    const fieldError = function ($field) {
      $field.siblings('[wr-type="error"]').show();
      $field.addClass("error");
      formErrors = true;
    };

    /**
     * Utility function to remove the error state for a given field.
     * @param {object} $field - jQuery-wrapped field element
     */
    const clearFieldError = function ($field) {
      $field.removeClass("error");
      $field.siblings('[wr-type="error"]').hide();
      formErrors = false; // reset so form can submit if all else is good
    };

    // Handle Submit button click
    $('[wr-type="submit"]').on("click", function () {
      // Reset formErrors before each validation pass
      formErrors = false;

      // Validate all required fields
      $('[wr-type="required-field"]').each(function () {
        const $this = $(this);
        const val = $this.val();

        // Check for empty
        if (!val) {
          fieldError($this);
          return;
        }

        // Validate email fields
        if (
          $this.attr("type") === "email" &&
          (val.indexOf("@") === -1 || val.indexOf(".") === -1)
        ) {
          fieldError($this);
          return;
        }
      });

      // If no errors, submit parent form
      if (!formErrors) {
        $(this).parents("form").submit();
      }
    });

    // Remove errors from field on keypress or blur
    $('[wr-type="required-field"]').on("keypress blur", function () {
      clearFieldError($(this));
    });

    // Pressing Enter triggers submission
    $("input, textarea").on("keypress", function (e) {
      if (e.keyCode === 13) {
        e.preventDefault();
        $(this).trigger("change");
        $('[wr-type="submit"]').click();
      }
    });

    // Grab the main Rent Form
    const rentForm = document.getElementById("wf-form-Rent-Form");

    // ---------------------------------------------------------------------
    // First Modal
    // ---------------------------------------------------------------------
    const datePickers = rentForm.querySelectorAll(".flatpickr-input");
    const getStartedBtn = rentForm.querySelector("#slider-1");

    // Initialize first flatpickr (index 0)
    const fp1 = flatpickr(datePickers[0], {
      minDate: "today",
      mode: "range",
    });

    // Check if the first date input is filled
    function checkForm(e) {
      if (!datePickers[0].value) {
        e.preventDefault();
        e.stopPropagation();
        fieldError($("#dates"));
      }
    }

    getStartedBtn.addEventListener("click", checkForm, true);

    // ---------------------------------------------------------------------
    // Second Modal
    // ---------------------------------------------------------------------
    const withDriver = document.getElementById("with-driver");
    const selfDrive = document.getElementById("self-drive");

    // NEW: references for Self-Drive file inputs
    const licenseFront = rentForm.querySelector("#license-upload-front");
    const licenseBack = rentForm.querySelector("#license-upload-back");

    // By default check "With Driver"
    withDriver.checked = false;
    withDriver.click();

    const nextStepBtn1 = rentForm.querySelector("#slider-2");

    function checkForm2(e) {
      // Must pick either withDriver or selfDrive
      if (!withDriver.checked && !selfDrive.checked) {
        e.preventDefault();
        e.stopPropagation();
        fieldError($("#with-driver"));
        fieldError($("#self-drive"));
      } 
      // If Self-Drive is selected, require front and back license
      else if (selfDrive.checked) {
        if (
          licenseFront.files.length === 0 ||
          licenseBack.files.length === 0
        ) {
          e.preventDefault();
          e.stopPropagation();
          fieldError($("#license-upload-front"));
          fieldError($("#license-upload-back"));
        }
      }
    }

    nextStepBtn1.addEventListener("click", checkForm2, true);

    // Remove errors when either checkbox changes
    function removeErrors() {
      if (withDriver.checked || selfDrive.checked) {
        clearFieldError($("#with-driver"));
        clearFieldError($("#self-drive"));
      }
    }

    withDriver.addEventListener("change", removeErrors);
    selfDrive.addEventListener("change", removeErrors);

    // ---------------------------------------------------------------------
    // Third Modal
    // ---------------------------------------------------------------------
    const airportPickup = document.getElementById("airport-pickup");
    const flightNumber = document.getElementById("flight-number");
    const flightTime = document.getElementById("flight-time");
    const nextStepBtn2 = rentForm.querySelector("#slider-3");

    // Initialize second flatpickr (index 1)
    const fp2 = flatpickr(datePickers[1], {
      minDate: "today",
      mode: "range",
    });

    // Remove 'wr-type' and 'required' from optional fields
    datePickers[1].removeAttribute("wr-type");
    flightNumber.removeAttribute("wr-type");
    flightTime.removeAttribute("wr-type");
    datePickers[1].removeAttribute("required");
    flightNumber.removeAttribute("required");
    flightTime.removeAttribute("required");

    function checkForm3(e) {
      if (
        airportPickup.checked &&
        (!flightNumber.value || !flightTime.value || !datePickers[1].value)
      ) {
        e.preventDefault();
        e.stopPropagation();

        if (!flightNumber.value) fieldError($("#flight-number"));
        if (!flightTime.value) fieldError($("#flight-time"));
        if (!datePickers[1].value) fieldError($("#pick-up-drop-off-date"));
      }
    }

    nextStepBtn2.addEventListener("click", checkForm3, true);

    // ---------------------------------------------------------------------
    // Fourth Modal
    // ---------------------------------------------------------------------
    const outOfAccra = document.getElementById("Out-Of-Accra");
    const nextStepBtn3 = rentForm.querySelector(
      ".slide:nth-child(4) .slider-right.w-button"
    );
    const checkbox9 = document.querySelectorAll("[name='checkbox-9']");

    outOfAccra.removeAttribute("required");

    function checkForm4(e) {
      if (outOfAccra.checked) {
        let regionSelected = false;
        for (let i = 0; i < checkbox9.length; i++) {
          if (checkbox9[i].checked) {
            regionSelected = true;
            break;
          }
        }
        if (!regionSelected) {
          e.preventDefault();
          e.stopPropagation();
        }
      }
    }

    nextStepBtn3.addEventListener("click", checkForm4, true);

    // ---------------------------------------------------------------------
    // Last Modal
    // ---------------------------------------------------------------------

    // NEW: references for ID upload fields
    const idFront = document.getElementById("id-upload-front");
    const idBack = document.getElementById("id-upload-back");

    // Make these required if you want them validated as required:
    idFront.setAttribute("wr-type", "required-field");
    idBack.setAttribute("wr-type", "required-field");
  });
</script>

<!-- Form Customization of Out of Accra, Self Drive & Airport PickUp -->
<script>
  var Webflow = Webflow || [];
  Webflow.push(function () {
    // Get elements and hide location and license details by default
    var checkboxLocation = document.getElementById("Out-Of-Accra");
    var checkboxLicense = document.getElementById("self-drive");
    var checkboxPickup = document.getElementById("airport-pickup");
    var locationDetails = document.getElementById("location-details");
    var licenseDetails = document.getElementById("license-details");
    var airportDetails = document.getElementById("airportpick-details");

    locationDetails.style.display = "none";
    licenseDetails.style.display = "none";
    airportDetails.style.display = "none";

    // Toggle location details
    checkboxLocation.addEventListener("click", function () {
      locationDetails.style.display = checkboxLocation.checked
        ? "block"
        : "none";
    });

    // Toggle license details
    checkboxLicense.addEventListener("click", function () {
      licenseDetails.style.display = checkboxLicense.checked
        ? "block"
        : "none";
    });

    // Toggle airport details
    checkboxPickup.addEventListener("click", function () {
      airportDetails.style.display = checkboxPickup.checked
        ? "block"
        : "none";
    });
  });
</script>

<!-- Search Feature - Out of Accra -->
<script>
  $(".on-page-search").on("keyup", function () {
    var v = $(this).val();
    $(".results").removeClass("results");
    $(".noresults").removeClass("noresults");

    $(".search-result").each(function () {
      var $this = $(this);
      if (v !== "" && $this.text().search(new RegExp(v, "gi")) !== -1) {
        $this.addClass("results");
      } else if (v !== "" && $this.text().search(v) !== 1) {
        $this.addClass("noresults");
      }
    });
  });
</script>

<script>
  // On window load, populate model fields and page URL
  window.addEventListener("load", function () {
    const model = document.getElementById("make");
    const carName = document.getElementById("car-name");

    const modelInput1 = document.getElementById("Vehicle-Model-Number");
    const modelInput2 = document.getElementById("Vehicle-Model-Number-2");
    const modelInput3 = document.getElementById("Vehicle-Model-Number-3");
    const modelInput4 = document.getElementById("Vehicle-Model-Number-4");

    const pageNameInput = document.getElementById("page-name");

    const modelInfo = model.textContent + " " + carName.textContent;

    // Populate model fields
    modelInput1.value = modelInfo;
    modelInput2.value = modelInfo;
    modelInput3.value = modelInfo;
    modelInput4.value = modelInfo;

    // Add the page URL to the "page-name" field
    pageNameInput.value = window.location.href;
  });
</script>
