<script>
$("input[type=file]").attr("multiple", "multiple");

$(document).ready(function() {
    
    // Hide all error messages initially
    $('[wr-type="error"]').hide();
    $('[wr-type="required-field"]').removeClass('error');

    let formErrors = false;

    // Function to trigger error display on a specific field
    function fieldError(field) {
        field.siblings('[wr-type="error"]').show();
        field.addClass('error');
        formErrors = true;
    }

    // Function to reset validation states
    function resetFormErrors() {
        formErrors = false;
        $('[wr-type="required-field"]').removeClass('error');
        $('[wr-type="error"]').hide();
    }

    // Prevent Next Step if Errors Exist
    function blockStepIfErrors(e) {
        if (formErrors) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        }
    }

    // General Submit Validation
    $('[wr-type="submit"]').click(function(e) {
        resetFormErrors();

        $('[wr-type="required-field"]').each(function() {
            if ($(this).val().trim().length === 0 || $(this).is(":invalid")) {
                fieldError($(this));
            }
        });

        $('[type="email"]').each(function() {
            let emailVal = $(this).val();
            if (emailVal && (emailVal.indexOf('@') === -1 || emailVal.indexOf('.') === -1)) {
                fieldError($(this));
            }
        });

        blockStepIfErrors(e);

        if (!formErrors) {
            $(this).parents('form').submit();
        }
    });

    $('[wr-type="required-field"]').on('keypress blur change', function() {
        $(this).removeClass('error');
        $(this).siblings('[wr-type="error"]').hide();
        formErrors = false;
    });

    $('input, textarea').keypress(function(e) { 
        if (e.keyCode === 13) {
            e.preventDefault();
        }
    });

    const rentForm = document.getElementById("wf-form-Rent-Form");

    // Modal 1 - Date Picker Validation
    const datePickers = rentForm.querySelectorAll(".flatpickr-input");
    const getStartedBtn = rentForm.querySelector("#slider-1");

    const fp1 = flatpickr(datePickers[0], {
        minDate: "today",
        mode : "range",
    });

    getStartedBtn.addEventListener("click", function(e) {
        resetFormErrors();
        if (datePickers[0].value.trim() === "") {
            fieldError($("#dates"));
        }
        blockStepIfErrors(e);
    });

    // Modal 2 - Self Drive & License Upload Validation
    const withDriver = document.getElementById("with-driver");
    const selfDrive = document.getElementById("self-drive");
    const fileInput = rentForm.querySelector("#file");
    const nextStepBtn1 = rentForm.querySelector("#slider-2");

    nextStepBtn1.addEventListener("click", function(e) {
        resetFormErrors();
        if (!withDriver.checked && !selfDrive.checked) {
            fieldError($("#with-driver"));
            fieldError($("#self-drive"));
        } 
        if (selfDrive.checked && fileInput.files.length === 0) {
            fieldError($("#file-upload"));
        }
        blockStepIfErrors(e);
    });

    withDriver.addEventListener('change', removeErrors);
    selfDrive.addEventListener('change', removeErrors);

    function removeErrors() {
        if (withDriver.checked || selfDrive.checked) {
            $("#with-driver, #self-drive").siblings('[wr-type="error"]').hide().removeClass('error');
            formErrors = false;
        }
    }

    // Modal 3 - Airport Pickup Validation
    const airportPickup = document.getElementById("airport-pickup");
    const flightNumber = document.getElementById("flight-number");
    const flightTime = document.getElementById("flight-time");
    const nextStepBtn2 = rentForm.querySelector("#slider-3");

    const fp2 = flatpickr(datePickers[1], {
        minDate: "today",
        mode : "range",
    });

    nextStepBtn2.addEventListener("click", function(e) {
        resetFormErrors();
        if (airportPickup.checked) {
            if (!flightNumber.value.trim()) fieldError($("#flight-number"));
            if (!flightTime.value.trim()) fieldError($("#flight-time"));
            if (!datePickers[1].value.trim()) fieldError($("#pick-up-drop-off-date"));
        }
        blockStepIfErrors(e);
    });

    // Modal 4 - Out of Accra Validation
    const outOfAccra = document.getElementById("Out-Of-Accra");
    const nextStepBtn3 = rentForm.querySelector(".slide:nth-child(4) .slider-right.w-button");
    const checkbox9 = document.querySelectorAll("[name='checkbox-9']");

    nextStepBtn3.addEventListener("click", function(e) {
        resetFormErrors();
        if (outOfAccra.checked) {
            let regionSelected = Array.from(checkbox9).some(checkbox => checkbox.checked);
            if (!regionSelected) {
                fieldError($(checkbox9[0])); // Show error on first checkbox as reference
            }
        }
        blockStepIfErrors(e);
    });

    // Last Modal - ID Upload
    const file2 = document.querySelectorAll("#id-upload");
    file2[1].setAttribute('wr-type', 'required-field');

});
</script>

<!-- Form Customization for Out of Accra, Self Drive & Airport Pickup -->
<script>
var Webflow = Webflow || [];
Webflow.push(function () {
    var checkboxLocation = document.getElementById("Out-Of-Accra");
    var checkboxLicense = document.getElementById("self-drive");
    var checkboxPickup = document.getElementById("airport-pickup");
    var locationDetails = document.getElementById("location-details");
    var licenseDetails = document.getElementById("license-details");
    var airportDetails = document.getElementById("airportpick-details");

    locationDetails.style.display = "none";
    licenseDetails.style.display = "none";
    airportDetails.style.display = "none";

    checkboxLocation.addEventListener("click", function () {
        locationDetails.style.display = checkboxLocation.checked ? "block" : "none";
    });

    checkboxLicense.addEventListener("click", function () {
        licenseDetails.style.display = checkboxLicense.checked ? "block" : "none";
    });

    checkboxPickup.addEventListener("click", function () {
        airportDetails.style.display = checkboxPickup.checked ? "block" : "none";
    });
});
</script>

<!-- Search Feature - Out of Accra -->
<script>
$(".on-page-search").on("keyup", function() {
    var v = $(this).val();
    $(".results, .noresults").removeClass("results noresults");
    $(".search-result").each(function() {
        if (v && $(this).text().search(new RegExp(v, 'gi')) !== -1) {
            $(this).addClass("results");
        } else if (v) {
            $(this).addClass("noresults");
        }
    });
});
</script>
