<script>
  // Enable multiple file uploads
  $("input[type=file]").attr("multiple", "multiple");

  $(document).ready(function () {
    "use strict";

    // Hide all error messages initially and remove any error classes
    $('[wr-type="error"]').hide();
    $('[wr-type="required-field"]').removeClass("error");

    let formErrors = false;

    // Utility function to display the error state for a given field.
    // For error icons to appear, each required field should have a sibling element with wr-type="error".
    const fieldError = function ($field) {
      $field.siblings('[wr-type="error"]').show();
      $field.addClass("error");
      formErrors = true;
    };

    // Utility function to remove the error state for a given field.
    const clearFieldError = function ($field) {
      $field.removeClass("error");
      $field.siblings('[wr-type="error"]').hide();
    };

    // Remove errors on keypress or blur for any required field.
    $('[wr-type="required-field"]').on("keypress blur", function () {
      clearFieldError($(this));
    });

    // Pressing Enter triggers submission.
    $("input, textarea").on("keypress", function (e) {
      if (e.keyCode === 13) {
        e.preventDefault();
        $(this).trigger("change");
        $('[wr-type="submit"]').click();
      }
    });

    // Grab the main Rent Form.
    const rentForm = document.getElementById("wf-form-Rent-Form");

    /* ------------------------------------
       STEP 1: Date Range Selection
       - Input ID: "dates"
       - Uses flatpickr with range mode.
    -------------------------------------- */
    const datesInput = document.getElementById("dates");
    const fp1 = flatpickr(datesInput, {
      minDate: "today",
      mode: "range"
    });

    const slider1 = document.getElementById("slider-1");
    function validateStep1(e) {
      if (!datesInput.value.trim()) {
        e.preventDefault();
        e.stopPropagation();
        fieldError($("#dates"));
        return false;
      }
      return true;
    }
    slider1.addEventListener("click", function (e) {
      if (validateStep1(e)) {
        Webflow.push(function () {
          // Navigate to Step 2 (insert Webflow navigation code here)
        });
      }
    }, true);

    /* ------------------------------------
       STEP 2: With Driver / Self Drive
       - Checkbox IDs: "with-driver" and "self-drive"
       - License file upload inputs: "Driving-License-Front" & "Driving-License-Back"
       - License details container IDs: "license-details-front" and "license-details-back"
    -------------------------------------- */
    // Force default selection using jQuery.
    $("#with-driver").prop("checked", true);
    $("#self-drive").prop("checked", false);

    const withDriver = document.getElementById("with-driver");
    const selfDrive = document.getElementById("self-drive");
    const licenseFront = document.getElementById("Driving-License-Front");
    const licenseBack = document.getElementById("Driving-License-Back");
    const licenseDetailsFront = document.getElementById("license-details-front");
    const licenseDetailsBack = document.getElementById("license-details-back");

    // Hide license details by default.
    $("#license-details-front, #license-details-back").hide();

    // Function to toggle license details based on the driver option.
    function toggleLicenseDetails() {
      if ($("#self-drive").is(":checked")) {
        // When Self Drive is selected, uncheck With Driver and show license upload fields.
        $("#with-driver").prop("checked", false);
        $("#license-details-front, #license-details-back").show();
      } else {
        // When With Driver is selected, ensure it remains checked and hide license upload fields.
        $("#with-driver").prop("checked", true);
        $("#license-details-front, #license-details-back").hide();
        clearFieldError($("#Driving-License-Front"));
        clearFieldError($("#Driving-License-Back"));
      }
    }
    // Update display on load.
    toggleLicenseDetails();
    // Use change event so the state updates as soon as the checkbox changes.
    $("#with-driver, #self-drive").on("change", toggleLicenseDetails);

    const slider2 = document.getElementById("slider-2");
    function validateStep2(e) {
      // Ensure at least one option is selected.
      if (!$("#with-driver").is(":checked") && !$("#self-drive").is(":checked")) {
        e.preventDefault();
        e.stopPropagation();
        fieldError($("#with-driver"));
        fieldError($("#self-drive"));
        return false;
      }
      // If Self Drive is selected, both license uploads are required.
      if ($("#self-drive").is(":checked")) {
        let valid = true;
        if (licenseFront.files.length === 0) {
          fieldError($("#Driving-License-Front"));
          valid = false;
        }
        if (licenseBack.files.length === 0) {
          fieldError($("#Driving-License-Back"));
          valid = false;
        }
        if (!valid) {
          e.preventDefault();
          e.stopPropagation();
          return false;
        }
      }
      return true;
    }
    slider2.addEventListener("click", function (e) {
      if (validateStep2(e)) {
        Webflow.push(function () {
          // Navigate to Step 3
        });
      }
    }, true);

    /* ------------------------------------
       STEP 3: Airport Pickup Details
       - Checkbox ID: "airport-pickup"
       - Inputs: "flight-number", "flight-time", "pick-up-drop-off-date"
       - Container for these details: "airportpick-details"
       - Uses flatpickr on the pickup/drop-off date.
    -------------------------------------- */
    const airportPickup = document.getElementById("airport-pickup");
    const flightNumber = document.getElementById("flight-number");
    const flightTime = document.getElementById("flight-time");
    const pickupDateInput = document.getElementById("pick-up-drop-off-date");
    const fp2 = flatpickr(pickupDateInput, {
      minDate: "today",
      mode: "range"
    });

    // Hide the Airport Pickup details container by default.
    $("#airportpick-details").hide();

    // Remove wr-type and required attributes from optional fields.
    if (pickupDateInput) {
      pickupDateInput.removeAttribute("wr-type");
      pickupDateInput.removeAttribute("required");
    }
    if (flightNumber) {
      flightNumber.removeAttribute("wr-type");
      flightNumber.removeAttribute("required");
    }
    if (flightTime) {
      flightTime.removeAttribute("wr-type");
      flightTime.removeAttribute("required");
    }

    const slider3 = document.getElementById("slider-3");
    function validateStep3(e) {
      if ($("#airport-pickup").is(":checked")) {
        let valid = true;
        if (!flightNumber.value.trim()) {
          fieldError($("#flight-number"));
          valid = false;
        }
        if (!flightTime.value.trim()) {
          fieldError($("#flight-time"));
          valid = false;
        }
        if (!pickupDateInput.value.trim()) {
          fieldError($("#pick-up-drop-off-date"));
          valid = false;
        }
        if (!valid) {
          e.preventDefault();
          e.stopPropagation();
          return false;
        }
      }
      return true;
    }
    slider3.addEventListener("click", function (e) {
      if (validateStep3(e)) {
        Webflow.push(function () {
          // Navigate to Step 4
        });
      }
    }, true);

    // Show/hide Airport Pickup details based on the checkbox selection.
    $("#airport-pickup").on("change", function () {
      $("#airportpick-details").toggle($(this).is(":checked"));
    });

    /* ------------------------------------
       STEP 4: Out-Of-Accra Region Selection
       - Checkbox ID: "Out-Of-Accra"
       - Region checkboxes must have the name "location-checkbox"
       - Container for region selection: "location-details"
    -------------------------------------- */
    // Force default state using jQuery.
    $("#Out-Of-Accra").prop("checked", false);
    $("#location-details").hide();

    const slider4 = document.getElementById("slider-4");
    function validateStep4(e) {
      if ($("#Out-Of-Accra").is(":checked")) {
        // At least one region checkbox (name "location-checkbox") must be selected.
        if ($("input[name='location-checkbox']:checked").length === 0) {
          e.preventDefault();
          e.stopPropagation();
          fieldError($("#location-details"));
          return false;
        } else {
          clearFieldError($("#location-details"));
        }
      }
      return true;
    }
    slider4.addEventListener("click", function (e) {
      if (validateStep4(e)) {
        Webflow.push(function () {
          // Navigate to the Final Step
        });
      }
    }, true);

    // Toggle region selection details when Out-Of-Accra is changed.
    $("#Out-Of-Accra").on("change", function () {
      $("#location-details").toggle($(this).is(":checked"));
    });

    /* ------------------------------------
       STEP 5: Final Submission - Identity Uploads
       - File upload inputs: "id-upload-front" and "id-upload-back"
    -------------------------------------- */
    const submitBtn = document.querySelector('[wr-type="submit"]');
    function validateFinalStep(e) {
      let valid = true;
      const idUploadFront = document.getElementById("id-upload-front");
      const idUploadBack = document.getElementById("id-upload-back");
      if (idUploadFront.files.length === 0) {
        fieldError($("#id-upload-front"));
        valid = false;
      }
      if (idUploadBack.files.length === 0) {
        fieldError($("#id-upload-back"));
        valid = false;
      }
      if (!valid) {
        e.preventDefault();
        e.stopPropagation();
        return false;
      }
      return true;
    }
    submitBtn.addEventListener("click", function (e) {
      if (validateFinalStep(e)) {
        $(this).closest("form").submit();
      }
    });
  });

  /* ------------------------------------
     On Window Load: Populate Model Fields and Page URL
  -------------------------------------- */
  window.addEventListener("load", function () {
    const model = document.getElementById("make");
    const carName = document.getElementById("car-name");
    const modelInfo = model.textContent + " " + carName.textContent;
    const modelInputIds = [
      "Vehicle-Model-Number",
      "Vehicle-Model-Number-2",
      "Vehicle-Model-Number-3",
      "Vehicle-Model-Number-4"
    ];
    modelInputIds.forEach(function (id) {
      const input = document.getElementById(id);
      if (input) {
        input.value = modelInfo;
      }
    });
    const pageNameInput = document.getElementById("page-name");
    if (pageNameInput) {
      pageNameInput.value = window.location.href;
    }
  });
</script>
