<script>
$(document).ready(function() {
  "use strict";

  // Enable multiple file uploads
  $("input[type=file]").attr("multiple", "multiple");

  // Hide error messages and remove error classes initially.
  $(".error-message").hide();
  $(".error").removeClass("error");

  // Helper functions for showing and hiding errors.
  function showError($field) {
    $field.addClass("error");
    $field.siblings(".error-message").fadeIn();
  }

  function hideError($field) {
    $field.removeClass("error");
    $field.siblings(".error-message").fadeOut();
  }

  // Clear errors when the user interacts with any input.
  $("input, textarea, select").on("keyup change blur", function() {
    hideError($(this));
  });
  $("input[type=file]").on("change", function() {
    hideError($(this));
  });

  // ---------------------------
  // STEP 1: Date Range Selection
  // ---------------------------
  // Initialize Flatpickr on the input with id "dates"
  var fp1 = flatpickr("#dates", {
    minDate: "today",
    mode: "range"
  });

  function validateStep1() {
    var valid = true;
    var $dates = $("#dates");
    if ($.trim($dates.val()) === "") {
      showError($dates);
      valid = false;
    } else {
      hideError($dates);
    }
    return valid;
  }

  // ---------------------------
  // STEP 2: Driver Option and License Uploads
  // ---------------------------
  // Ensure "With Driver" is selected by default and hide license upload sections.
  $("#with-driver").prop("checked", true);
  $("#self-drive").prop("checked", false);
  $("#license-details-front, #license-details-back").hide();

  function toggleLicenseFields() {
    if ($("#self-drive").is(":checked")) {
      // If Self Drive is selected, uncheck With Driver and show license upload fields.
      $("#with-driver").prop("checked", false);
      $("#license-details-front, #license-details-back").slideDown();
    } else {
      // If Self Drive is not selected, check With Driver and hide license upload fields.
      $("#with-driver").prop("checked", true);
      $("#license-details-front, #license-details-back").slideUp();
      hideError($("#Driving-License-Front"));
      hideError($("#Driving-License-Back"));
    }
  }
  $("#with-driver, #self-drive").on("change", toggleLicenseFields);

  function validateStep2() {
    var valid = true;
    // At least one of the options must be selected.
    if (!$("#with-driver").is(":checked") && !$("#self-drive").is(":checked")) {
      showError($("#with-driver"));
      showError($("#self-drive"));
      valid = false;
    } else {
      hideError($("#with-driver"));
      hideError($("#self-drive"));
    }
    // If Self Drive is selected, both driving license uploads are required.
    if ($("#self-drive").is(":checked")) {
      if ($("#Driving-License-Front")[0].files.length === 0) {
        showError($("#Driving-License-Front"));
        valid = false;
      }
      if ($("#Driving-License-Back")[0].files.length === 0) {
        showError($("#Driving-License-Back"));
        valid = false;
      }
    }
    return valid;
  }

  // ---------------------------
  // STEP 3: Airport Pickup Details
  // ---------------------------
  // Initialize Flatpickr on the pickup/drop-off date input (id "pickup-dropoff-date")
  var fp2 = flatpickr("#pickup-dropoff-date", {
    minDate: "today",
    mode: "range"
  });

  function validateStep3() {
    var valid = true;
    if ($("#airport-pickup").is(":checked")) {
      if ($.trim($("#flight-number").val()) === "") {
        showError($("#flight-number"));
        valid = false;
      }
      if ($.trim($("#flight-time").val()) === "") {
        showError($("#flight-time"));
        valid = false;
      }
      if ($.trim($("#pickup-dropoff-date").val()) === "") {
        showError($("#pickup-dropoff-date"));
        valid = false;
      }
    }
    return valid;
  }

  // ---------------------------
  // STEP 4: Out-Of-Accra Region Selection
  // ---------------------------
  function validateStep4() {
    var valid = true;
    if ($("#Out-Of-Accra").is(":checked")) {
      // At least one region checkbox (name "location-checkbox") must be selected.
      if ($("input[name='location-checkbox']:checked").length === 0) {
        showError($("#location-details"));
        valid = false;
      } else {
        hideError($("#location-details"));
      }
    }
    return valid;
  }

  // ---------------------------
  // STEP 5: Final Submission - Identity Uploads
  // ---------------------------
  function validateStep5() {
    var valid = true;
    if ($("#id-upload-front")[0].files.length === 0) {
      showError($("#id-upload-front"));
      valid = false;
    }
    if ($("#id-upload-back")[0].files.length === 0) {
      showError($("#id-upload-back"));
      valid = false;
    }
    return valid;
  }

  // ---------------------------
  // Step Navigation: Next Button Click Events
  // ---------------------------
  // Each step's next button validates only that step. The following assumes the buttons have ids "slider-1", "slider-2", etc.
  $("#slider-1").on("click", function(e) {
    if (!validateStep1()) {
      e.preventDefault();
      return false;
    } else {
      Webflow.push(function() {
        // Code to navigate to Step 2 goes here.
      });
    }
  });

  $("#slider-2").on("click", function(e) {
    if (!validateStep2()) {
      e.preventDefault();
      return false;
    } else {
      Webflow.push(function() {
        // Code to navigate to Step 3 goes here.
      });
    }
  });

  $("#slider-3").on("click", function(e) {
    if (!validateStep3()) {
      e.preventDefault();
      return false;
    } else {
      Webflow.push(function() {
        // Code to navigate to Step 4 goes here.
      });
    }
  });

  $("#slider-4").on("click", function(e) {
    if (!validateStep4()) {
      e.preventDefault();
      return false;
    } else {
      Webflow.push(function() {
        // Code to navigate to Step 5 goes here.
      });
    }
  });

  // Final Submission Button (assumed to have the attribute wr-type="submit")
  $('[wr-type="submit"]').on("click", function(e) {
    if (!validateStep5()) {
      e.preventDefault();
      return false;
    } else {
      // Assume previous steps are already validated if the user reached this point.
      $(this).closest("form").submit();
    }
  });

  // ---------------------------
  // Show/Hide Additional Sections Based on Checkbox Selections
  // ---------------------------
  $("#airport-pickup").on("change", function() {
    if ($(this).is(":checked")) {
      $("#airportpick-details").slideDown();
    } else {
      $("#airportpick-details").slideUp();
    }
  });

  $("#Out-Of-Accra").on("change", function() {
    if ($(this).is(":checked")) {
      $("#location-details").slideDown();
    } else {
      $("#location-details").slideUp();
    }
  });

  // On window load, ensure extra sections are hidden if not applicable.
  $(window).on("load", function() {
    $("#airportpick-details").hide();
    $("#location-details").hide();
    if (!$("#self-drive").is(":checked")) {
      $("#license-details-front, #license-details-back").hide();
    }
  });
});
</script>
