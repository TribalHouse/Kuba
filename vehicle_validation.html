<script>
$(document).ready(function () {
  "use strict";

  // --------------------------------------------------------------
  // Global Setup
  // --------------------------------------------------------------
  $("input[type=file]").attr("multiple", "multiple"); // Allow multiple file selection
  $('[wr-type="error"]').hide(); // Hide all error messages initially
  $('[wr-type="required-field"]').removeClass("error"); // Ensure no fields are marked as error at start
  var formErrors = false; // Track form errors

  // Utility: Mark a field as having an error.
  function fieldError($field) {
    var errorElem = $field.siblings('[wr-type="error"]');
    if (errorElem.length === 0) {
      errorElem = $field.find('[wr-type="error"]');
    }
    errorElem.show(); // Show error message
    $field.addClass("error"); // Add error class
    formErrors = true;
  }

  // Utility: Clear a field's error.
  function clearFieldError($field) {
    $field.removeClass("error"); // Remove error class
    var errorElem = $field.siblings('[wr-type="error"]');
    if (errorElem.length === 0) {
      errorElem = $field.find('[wr-type="error"]');
    }
    errorElem.hide(); // Hide error message
  }

  // --------------------------------------------------------------
  // Step 1: Date Selection
  // --------------------------------------------------------------
  var rentForm = document.getElementById("wf-form-Rent-Form");
  var datePickers = rentForm.querySelectorAll(".flatpickr-input");
  var getStartedBtn = rentForm.querySelector("#slider-1");
  var fp1 = flatpickr(datePickers[0], { minDate: "today", mode: "range" }); // Date picker setup

  function checkForm(e) {
    if (!datePickers[0].value) {
      e.preventDefault();
      e.stopPropagation();
      fieldError($("#dates")); // Mark error if no date selected
    }
  }
  getStartedBtn.addEventListener("click", checkForm, true);

  // --------------------------------------------------------------
  // Step 2: Driver Option & License Upload Validation
  // --------------------------------------------------------------
  var withDriver = document.getElementById("with-driver");
  var selfDrive = document.getElementById("self-drive");

  var licenseDetailsFront = document.getElementById("license-details-front");
  var licenseDetailsBack = document.getElementById("license-details-back");

  
  if (selfDrive) {
    $(selfDrive).prop("checked", false).removeAttr("checked"); // Ensure self-drive is unchecked initially
  }

  if (licenseDetailsFront) {
    licenseDetailsFront.style.display = "none"; // Hide license upload fields initially
  }
  if (licenseDetailsBack) {
    licenseDetailsBack.style.display = "none";
  }

  var licenseInputFront = licenseDetailsFront ? licenseDetailsFront.querySelector("input[type='file']") : null;
  var licenseInputBack = licenseDetailsBack ? licenseDetailsBack.querySelector("input[type='file']") : null;

  if (licenseInputFront) {
    $(licenseInputFront).attr("wr-type", "required-field");
  }
  if (licenseInputBack) {
    $(licenseInputBack).attr("wr-type", "required-field");
  }

  if (withDriver) {
    withDriver.addEventListener("change", function () {
      if ($(withDriver).is(":checked")) {
        clearFieldError($(withDriver).closest("label"));
        clearFieldError($(selfDrive).closest("label"));

        if (selfDrive) {
          selfDrive.checked = false;
          $(selfDrive).closest("label").removeClass("w--redirected-checked");
        }
        $(withDriver).closest("label").addClass("w--redirected-checked");

        if (licenseDetailsFront) {
          licenseDetailsFront.style.display = "none";
          clearFieldError($(licenseDetailsFront));
        }
        if (licenseDetailsBack) {
          licenseDetailsBack.style.display = "none";
          clearFieldError($(licenseDetailsBack));
        }
      }
    });
  }

  if (selfDrive) {
    selfDrive.addEventListener("change", function () {
      if ($(selfDrive).is(":checked")) {
        clearFieldError($(selfDrive).closest("label"));
        clearFieldError($(withDriver).closest("label"));

        if (withDriver) {
          withDriver.checked = false;
          $(withDriver).closest("label").removeClass("w--redirected-checked");
        }
        $(selfDrive).closest("label").addClass("w--redirected-checked");

        if (licenseDetailsFront) {
          licenseDetailsFront.style.display = "block"; // Show license upload fields for self-drive
        }
        if (licenseDetailsBack) {
          licenseDetailsBack.style.display = "block";
        }
      }
    });
  }
});

</script>
