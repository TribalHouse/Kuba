<script>
$(document).ready(function() {
    $("input[type=file]").attr("multiple", "multiple");
    
    const formErrors = false;
    
    const fieldError = (field) => {
        field.siblings('[wr-type="error"]').show();
        field.addClass('error');
        formErrors = true;
    };

    $('[wr-type="submit"]').click(function() {
        $('[wr-type="required-field"]').each(function() {
            if ($(this).val().length === 0 || 
               ($(this).attr('type') === 'email' && 
               ($(this).val().indexOf('@') === -1 || $(this).val().indexOf('.') === -1))) {
                fieldError($(this));
            }
        });
        if (!formErrors) $(this).parents('form').submit();
    });

    $('[wr-type="required-field"]').on('keypress blur', function() {
        $(this).removeClass('error');
        $(this).siblings('[wr-type="error"]').hide();
    });

    $('input, textarea').keypress(function(e) { 
        if (e.keyCode == 13) {
            e.preventDefault();
            $(this).trigger("change");
            $('[wr-type="submit"]').click();
        }
    });

    const rentForm = document.getElementById("wf-form-Rent-Form");

    const datePickers = rentForm.querySelectorAll(".flatpickr-input");
    const getStartedBtn = rentForm.querySelector("#slider-1");

    flatpickr(datePickers[0], { minDate: "today", mode : "range" });

    getStartedBtn.addEventListener("click", (e) => {
        if (datePickers[0].value == "") {
            e.stopPropagation();
            e.preventDefault();
            fieldError($("#dates"));
        }
    }, true);

    const withDriver = document.getElementById("with-driver");
    const selfDrive = document.getElementById("self-drive");
    const fileInput = rentForm.querySelector("#file");

    withDriver.checked = false;
    withDriver.click();

    const nextStepBtn1 = rentForm.querySelector("#slider-2");

    nextStepBtn1.addEventListener("click", (e) => {
        if (!withDriver.checked && !selfDrive.checked) {
            e.stopPropagation();
            e.preventDefault();
            fieldError($("#with-driver"));
            fieldError($("#self-drive"));
        } else if (selfDrive.checked && fileInput.files.length == 0) {
            e.stopPropagation();
            e.preventDefault();
            fieldError($("#file-upload"));
        }
    }, true);

    withDriver.addEventListener('change', removeErrors);
    selfDrive.addEventListener('change', removeErrors);

    function removeErrors() {
        if (withDriver.checked || selfDrive.checked) {
            $("#with-driver").siblings('[wr-type="error"]').hide();
            $("#with-driver").removeClass('error');
            $("#self-drive").siblings('[wr-type="error"]').hide();
            $("#self-drive").removeClass('error');
        }
    }

    const airportPickup = document.getElementById("airport-pickup");
    const flightNumber = document.getElementById("flight-number");
    const flightTime = document.getElementById("flight-time");
    const nextStepBtn2 = rentForm.querySelector("#slider-3");

    flatpickr(datePickers[1], { minDate: "today", mode : "range" });

    datePickers[1].removeAttribute('wr-type');
    flightNumber.removeAttribute('wr-type');
    flightTime.removeAttribute('wr-type');
    datePickers[1].removeAttribute('required');
    flightNumber.removeAttribute('required');
    flightTime.removeAttribute('required');

    nextStepBtn2.addEventListener("click", (e) => {
        if (airportPickup.checked && (flightNumber.value == "" || flightTime.value == "" || datePickers[1].value == "")) {
            e.stopPropagation();
            e.preventDefault();
            if (flightNumber.value == "") fieldError($("#flight-number"));
            if (flightTime.value == "") fieldError($("#flight-time"));
            if (datePickers[1].value == "") fieldError($("#pick-up-drop-off-date"));
        }
    }, true);

    const outOfAccra = document.getElementById("Out-Of-Accra");
    const nextStepBtn3 = rentForm.querySelector(".slide:nth-child(4) .slider-right.w-button");
    const checkbox9 = document.querySelectorAll("[name='checkbox-9']");

    outOfAccra.removeAttribute("required");

    nextStepBtn3.addEventListener("click", (e) => {
        if (outOfAccra.checked) {
            let regionSelected = false;
            checkbox9.forEach((checkbox) => {
                if (checkbox.checked) regionSelected = true;
            });
            if (!regionSelected) {
                e.stopPropagation();
                e.preventDefault();
            }
        }
    }, true);

    const file2 = document.querySelectorAll("#id-upload");
    file2[1].setAttribute('wr-type', 'required-field');
});

var Webflow = Webflow || [];
Webflow.push(function () {
    const checkboxLocation = document.getElementById("Out-Of-Accra");
    const checkboxLicense = document.getElementById("self-drive");
    const checkboxPickup = document.getElementById("airport-pickup");
    const locationDetails = document.getElementById("location-details");
    const licenseDetails = document.getElementById("license-details");
    const airportDetails = document.getElementById("airportpick-details");

    locationDetails.style.display = "none";
    licenseDetails.style.display = "none";
    airportDetails.style.display = "none";

    checkboxLocation.addEventListener("click", () => {
        locationDetails.style.display = checkboxLocation.checked ? "block" : "none";
    });

    checkboxLicense.addEventListener("click", () => {
        licenseDetails.style.display = checkboxLicense.checked ? "block" : "none";
    });

    checkboxPickup.addEventListener("click", () => {
        airportDetails.style.display = checkboxPickup.checked ? "block" : "none";
    });
});

$(".on-page-search").on("keyup", function() {
    const v = $(this).val();
    $(".results").removeClass("results");
    $(".noresults").removeClass("noresults");
    $(".search-result").each(function() {
        $(this).toggleClass("results", v !== "" && $(this).text().search(new RegExp(v, 'gi')) !== -1);
        $(this).toggleClass("noresults", v !== "" && $(this).text().search(v) !== 1);
    });
});

window.addEventListener('load', function() {
    const model = document.getElementById("make");
    const carName = document.getElementById("car-name");

    const modelInputs = document.querySelectorAll("#Vehicle-Model-Number, #Vehicle-Model-Number-2, #Vehicle-Model-Number-3, #Vehicle-Model-Number-4");
    modelInputs.forEach(input => input.value = `${model.textContent} ${carName.textContent}`);

    document.getElementById("page-name").value = window.location.href;
});

var Webflow = Webflow || [];
Webflow.push(function() {
    const sliderArrows = [
        { slider: '#flowbaseSlider', left: '.slider-left', right: '.slider-right' },
        { slider: '#swapSlider', left: '.slider-left', right: '.slider-right' }
    ];

    sliderArrows.forEach(({ slider, left, right }) => {
        const l = $(`${slider} .w-slider-arrow-left`);
        const r = $(`${slider} .w-slider-arrow-right`);
        $(slider).on('click', left, () => l.trigger('tap'));
        $(slider).on('click', right, () => r.trigger('tap'));
    });
});
</script>
