<!-- Give every file input the "multiple" ability (optional) -->
<script>
  $("input[type=file]").attr("multiple", "multiple");
</script>

<script>
  $(document).ready(function () {
    "use strict";

    //--------------------------------------------------------------------
    // 1. Hide all error messages & remove error classes on initial load
    //--------------------------------------------------------------------
    $('[wr-type="error"]').hide();
    $('[wr-type="required-field"]').removeClass("error");

    let formErrors = false;

    //--------------------------------------------------------------------
    // Utility: Shows an error on a single field & sets a global flag
    //--------------------------------------------------------------------
    const fieldError = function ($field) {
      $field.siblings('[wr-type="error"]').show(); // display the error message
      $field.addClass("error");                    // add error styling
      formErrors = true;
    };

    //--------------------------------------------------------------------
    // Utility: Clears errors on a single field & resets global flag
    //--------------------------------------------------------------------
    const clearFieldError = function ($field) {
      $field.removeClass("error");
      $field.siblings('[wr-type="error"]').hide();
      // Note: Setting formErrors = false here can be risky if
      // multiple fields had errors. Often you'd re-validate all
      // fields. But we'll keep the original logic for simplicity:
      formErrors = false;
    };

    //--------------------------------------------------------------------
    // MAIN Submit button - final check of all wr-type="required-field"
    //--------------------------------------------------------------------
    $('[wr-type="submit"]').on("click", function () {
      // Reset global formErrors
      formErrors = false;

      // Validate all required fields
      $('[wr-type="required-field"]').each(function () {
        const $this = $(this);
        const val = $this.val();

        // Empty check
        if (!val) {
          fieldError($this);
          return;
        }

        // Email check
        if (
          $this.attr("type") === "email" &&
          (val.indexOf("@") === -1 || val.indexOf(".") === -1)
        ) {
          fieldError($this);
          return;
        }
      });

      // If still no errors, submit form
      if (!formErrors) {
        $(this).closest("form").submit();
      }
    });

    //--------------------------------------------------------------------
    // Clear errors when typing or leaving any "required-field"
    //--------------------------------------------------------------------
    $('[wr-type="required-field"]').on("keypress blur", function () {
      clearFieldError($(this));
    });

    //--------------------------------------------------------------------
    // Pressing Enter triggers the same final submission check
    //--------------------------------------------------------------------
    $("input, textarea").on("keypress", function (e) {
      if (e.keyCode === 13) {
        e.preventDefault();
        $(this).trigger("change");
        $('[wr-type="submit"]').click();
      }
    });

    //--------------------------------------------------------------------
    // Grab main form (for step-by-step logic)
    //--------------------------------------------------------------------
    const rentForm = document.getElementById("wf-form-Rent-Form");

    //--------------------------------------------------------------------
    // STEP 1: "slider-1" => Validate first date range
    //--------------------------------------------------------------------
    const datePickers = rentForm.querySelectorAll(".flatpickr-input");
    const getStartedBtn = document.getElementById("slider-1");

    // Initialize flatpickr #1
    flatpickr(datePickers[0], {
      minDate: "today",
      mode: "range",
    });

    function checkFormStep1(e) {
      // If first date is empty => block next
      if (!datePickers[0].value) {
        e.preventDefault();
        e.stopPropagation();
        fieldError($("#dates")); // #dates is presumably the field with wr-type="required-field"
      }
    }
    getStartedBtn.addEventListener("click", checkFormStep1, true);

    //--------------------------------------------------------------------
    // STEP 2: "slider-2" => With Driver vs Self Drive
    //--------------------------------------------------------------------
    const withDriver = document.getElementById("with-driver");
    const selfDrive = document.getElementById("self-drive");
    const nextStepBtn1 = document.getElementById("slider-2");

    // Two license file inputs if "Self Drive"
    const licenseFront = document.getElementById("license-upload-front");
    const licenseBack = document.getElementById("license-upload-back");

    // By default, let's ensure "With Driver" is checked
    withDriver.checked = false;
    withDriver.click(); // ensures withDriver is the active choice

    function checkFormStep2(e) {
      // Must choose at least one
      if (!withDriver.checked && !selfDrive.checked) {
        e.preventDefault();
        e.stopPropagation();
        fieldError($("#with-driver"));
        fieldError($("#self-drive"));
        return;
      }

      // If "Self Drive" is chosen => check the two license fields
      if (selfDrive.checked) {
        // Check front license
        if (licenseFront.files.length === 0) {
          e.preventDefault();
          e.stopPropagation();
          fieldError($("#license-upload-front"));
          return; // If there's an error here, stop immediately
        }
        // Check back license
        if (licenseBack.files.length === 0) {
          e.preventDefault();
          e.stopPropagation();
          fieldError($("#license-upload-back"));
          return;
        }
      }
    }
    nextStepBtn1.addEventListener("click", checkFormStep2, true);

    // Remove errors if user changes these checkboxes
    function removeDriverErrors() {
      if (withDriver.checked || selfDrive.checked) {
        clearFieldError($("#with-driver"));
        clearFieldError($("#self-drive"));
      }
    }
    withDriver.addEventListener("change", removeDriverErrors);
    selfDrive.addEventListener("change", removeDriverErrors);

    //--------------------------------------------------------------------
    // STEP 3: "slider-3" => Airport Pickup fields
    //--------------------------------------------------------------------
    const airportPickup = document.getElementById("airport-pickup");
    const flightNumber = document.getElementById("flight-number");
    const flightTime = document.getElementById("flight-time");
    const nextStepBtn2 = document.getElementById("slider-3");

    // Initialize flatpickr #2
    flatpickr(datePickers[1], {
      minDate: "today",
      mode: "range",
    });

    // Remove "required" from these optional fields
    datePickers[1].removeAttribute("wr-type");
    flightNumber.removeAttribute("wr-type");
    flightTime.removeAttribute("wr-type");

    function checkFormStep3(e) {
      // Validate flight info only if "Airport Pickup" is checked
      if (airportPickup.checked) {
        if (!flightNumber.value) {
          e.preventDefault();
          e.stopPropagation();
          fieldError($("#flight-number"));
        }
        if (!flightTime.value) {
          e.preventDefault();
          e.stopPropagation();
          fieldError($("#flight-time"));
        }
        if (!datePickers[1].value) {
          e.preventDefault();
          e.stopPropagation();
          fieldError($("#pick-up-drop-off-date"));
        }
      }
    }
    nextStepBtn2.addEventListener("click", checkFormStep3, true);

    //--------------------------------------------------------------------
    // STEP 4: "slider-right.w-button" in .slide:nth-child(4)
    //         => If Out-of-Accra is checked, user must pick at least 1 region
    //--------------------------------------------------------------------
    const outOfAccra = document.getElementById("Out-Of-Accra");
    const nextStepBtn3 = document.querySelector(".slide:nth-child(4) .slider-right.w-button");
    const checkbox9 = document.querySelectorAll("[name='checkbox-9']");

    // Make sure we remove "required" from the main outOfAccra checkbox
    outOfAccra.removeAttribute("required");

    function checkFormStep4(e) {
      // If user selected "Out of Accra" => Must choose at least 1 region
      if (outOfAccra.checked) {
        let regionSelected = false;
        checkbox9.forEach((box) => {
          if (box.checked) {
            regionSelected = true;
          }
        });

        if (!regionSelected) {
          e.preventDefault();
          e.stopPropagation();
          // Optionally show an error message to user
          // fieldError($("#out-of-accra-error-message")); // if you have such an element
        }
      }
    }
    nextStepBtn3.addEventListener("click", checkFormStep4, true);

    //--------------------------------------------------------------------
    // STEP 5 (Last Step): ID Front / ID Back
    //         You said you want separate validation for each one.
    //--------------------------------------------------------------------
    const idFront = document.getElementById("id-upload-front");
    const idBack = document.getElementById("id-upload-back");
    const lastNextBtn = document.getElementById("slider-5"); 
    // ^ If you have a separate "next" button for Step 5. 
    //   If it's just the final [wr-type="submit"], see notes below.

    // Because you want separate checks, let's do it on Step 5:
    function checkFormStep5(e) {
      // We'll individually show errors if empty:
      if (idFront.files.length === 0) {
        e.preventDefault();
        e.stopPropagation();
        fieldError($("#id-upload-front"));
      }
      if (idBack.files.length === 0) {
        e.preventDefault();
        e.stopPropagation();
        fieldError($("#id-upload-back"));
      }
    }

    // If you truly have a "slider-5" button, uncomment this:
    if (lastNextBtn) {
      lastNextBtn.addEventListener("click", checkFormStep5, true);
    }

    // If you'd also like final submission to verify them, 
    // make sure they have wr-type="required-field" or do 
    // a similar check in the final submission code.

    // Example:
    idFront.setAttribute("wr-type", "required-field");
    idBack.setAttribute("wr-type", "required-field");
  });
</script>

<!-- Step-by-step sections above remain the same for:
     - Out of Accra
     - Airport Pickup toggles
     - Searching, etc. -->
     
<!-- If you use Webflow push for show/hide, keep that code as is. -->
<script>
  var Webflow = Webflow || [];
  Webflow.push(function () {
    // Show/hide details logic
    var checkboxLocation = document.getElementById("Out-Of-Accra");
    var checkboxLicense = document.getElementById("self-drive");
    var checkboxPickup = document.getElementById("airport-pickup");
    var locationDetails = document.getElementById("location-details");
    var licenseDetails = document.getElementById("license-details");
    var airportDetails = document.getElementById("airportpick-details");

    locationDetails.style.display = "none";
    licenseDetails.style.display = "none";
    airportDetails.style.display = "none";

    checkboxLocation.addEventListener("click", function () {
      locationDetails.style.display = checkboxLocation.checked ? "block" : "none";
    });

    checkboxLicense.addEventListener("click", function () {
      licenseDetails.style.display = checkboxLicense.checked ? "block" : "none";
    });

    checkboxPickup.addEventListener("click", function () {
      airportDetails.style.display = checkboxPickup.checked ? "block" : "none";
    });
  });
</script>

<!-- Search Feature remains the same -->
<script>
  $(".on-page-search").on("keyup", function () {
    var v = $(this).val();
    $(".results").removeClass("results");
    $(".noresults").removeClass("noresults");

    $(".search-result").each(function () {
      var $this = $(this);
      if (v !== "" && $this.text().search(new RegExp(v, "gi")) !== -1) {
        $this.addClass("results");
      } else if (v !== "" && $this.text().search(v) !== 1) {
        $this.addClass("noresults");
      }
    });
  });
</script>

<script>
  // On window load, fill hidden fields with vehicle model/page URL
  window.addEventListener("load", function () {
    const model = document.getElementById("make");
    const carName = document.getElementById("car-name");

    const modelInput1 = document.getElementById("Vehicle-Model-Number");
    const modelInput2 = document.getElementById("Vehicle-Model-Number-2");
    const modelInput3 = document.getElementById("Vehicle-Model-Number-3");
    const modelInput4 = document.getElementById("Vehicle-Model-Number-4");
    const pageNameInput = document.getElementById("page-name");

    const modelInfo = model.textContent + " " + carName.textContent;

    modelInput1.value = modelInfo;
    modelInput2.value = modelInfo;
    modelInput3.value = modelInfo;
    modelInput4.value = modelInfo;

    pageNameInput.value = window.location.href;
  });
</script>
